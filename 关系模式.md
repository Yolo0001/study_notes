### **关系模式（Relational Schema）详解**

**关系模式** 是关系数据库的理论基础，它定义了 **表（关系）的结构**，包括 **属性（列）、数据类型、约束（主键、外键等）**，但不包含具体的数据（元组/行）。它是数据库设计的 **逻辑框架**。

---

## **1. 关系模式的定义**
关系模式可以形式化表示为：
$( R(U, D, DOM, F) )$
其中：
- \( R \)：关系名（表名）
- \( U \)：属性集合（列名），如 \( U = \{A$_1$, A$_2$, ..., A$_n$\} \)
- \( D \)：属性的域（数据类型），如 \( D = \{INT, VARCHAR, DATE\} \)
- \( DOM \)：属性到域的映射（如 \( A$_1$ $\rightarrow$ INT \)）
- $( F )$：属性间的 **函数依赖（Functional Dependency）** 约束（用于规范化）

**示例**：
```
学生（学号，姓名，年龄，系名）
```
- **关系名**：`学生`
- **属性集合**：`{学号, 姓名, 年龄, 系名}`
- **数据类型**：`学号(CHAR)，姓名(VARCHAR)，年龄(INT)，系名(VARCHAR)`
- **约束**：`学号` 是主键（唯一且非空）

---

## **2. 关系模式 vs. 关系（表）**
| **关系模式（Schema）**     | **关系（Relation）**      |
| -------------------- | --------------------- |
| 表的 **结构定义**（逻辑设计）    | 表的 **具体数据**（物理存储）     |
| 类似于编程中的 **类（Class）** | 类似于类的 **实例（Object）**  |
| 示例：`学生(学号, 姓名, 年龄)`  | 示例：`(1001, "张三", 20)` |

---

## **3. 关系模式的核心特性**
### **(1) 属性（Attributes）**
- 表示表的列，如 `学号`、`姓名`。
- 每个属性有 **数据类型**（如 `INT`、`VARCHAR`）。

### **(2) 域（Domain）**
- 属性的取值范围，如 `年龄` 的域是 `0~150`。

### **(3) 候选键（Candidate Key）**
- 能唯一标识元组（行）的最小属性集合。
- 示例：
  - 在 `学生(学号, 身份证号, 姓名)` 中，`{学号}` 和 `{身份证号}` 都是候选键。

### **(4) 主键（Primary Key）**
- 从候选键中选出的 **唯一标识符**（不能为 `NULL`）。
- 示例：
  - `学生` 表的主键是 `学号`。

### **(5) 外键（Foreign Key）**
- 用于关联其他表的属性，必须引用目标表的 **主键**。
- 示例：
  - `选课(学号, 课程号)` 中的 `学号` 是外键，引用 `学生(学号)`。

---

## **4. 关系模式的表示方法**
### **(1) 文本表示**

```
学生（学号: CHAR(10), 姓名: VARCHAR(20), 年龄: INT, 系名: VARCHAR(50)）
```
- 标注属性名和数据类型。

### **(2) 图形化表示（ER 图）**

```
+--------------+
|    学生      |
+--------------+
| 学号 (PK)    |
| 姓名         |
| 年龄         |
| 系名         |
+--------------+
```
- PK = Primary Key（主键）

### **(3) SQL 语句**
```sql
CREATE TABLE 学生 (
    学号 CHAR(10) PRIMARY KEY,
    姓名 VARCHAR(20) NOT NULL,
    年龄 INT,
    系名 VARCHAR(50)
);
```

---

## **5. 关系模式的设计原则**
### **(1) 满足 1NF（第一范式）**
- 所有属性必须是 **原子值**（不可再分）。
- 示例：
  - ❌ 错误：`课程(学生ID, 课程列表)`，其中 `课程列表` 存储多个值（如 `"数学, 物理"`）。
  - ✅ 正确：`选课(学生ID, 课程ID)`，每行只存储一个课程。

### **(2) 减少数据冗余**
- 通过 **规范化（Normalization）** 分解表，避免重复存储数据。
- 示例：
  - ❌ 冗余设计：
    ```
    学生(学号, 姓名, 系名, 系主任)
    ```
    （如果多个学生属于同一系，`系名` 和 `系主任` 会重复存储）
  - ✅ 规范化设计：
    ```
    学生(学号, 姓名, 系ID)
    系(系ID, 系名, 系主任)
    ```

### **(3) 保持数据完整性**
- 使用 **主键、外键、CHECK 约束** 等保证数据一致性。
- 示例：
  ```sql
  CREATE TABLE 学生 (
      学号 CHAR(10) PRIMARY KEY,
      年龄 INT CHECK (年龄 >= 0 AND 年龄 <= 150)
  );
  ```

---

## **6. 关系模式的优化**
### **(1) 规范化（Normalization）**
- 分解表以消除冗余，通常到 **3NF 或 BCNF**。
- 示例：
  - 将 `学生(学号, 姓名, 系名, 系主任)` 分解为：
    - `学生(学号, 姓名, 系ID)`
    - `系(系ID, 系名, 系主任)`

### **(2) 反规范化（Denormalization）**
- 为了提高查询性能，允许少量冗余（如数据仓库）。

---

## **7. 总结**
| **关键点**               | **说明**                                                                 |
|--------------------------|-------------------------------------------------------------------------|
| **关系模式**             | 表的逻辑结构定义（属性、数据类型、约束）。                               |
| **关系 vs. 关系模式**    | 模式是结构，关系是数据。                                                |
| **核心组成部分**         | 属性、域、候选键、主键、外键。                                          |
| **设计原则**             | 满足 1NF、减少冗余、保持数据完整性。                                    |
| **优化方法**             | 规范化（3NF/BCNF）或反规范化（提高查询性能）。                          |

关系模式是数据库设计的 **核心基础**，合理的模式设计能确保数据 **高效、无冗余、一致**。